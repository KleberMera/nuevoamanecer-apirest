generator client {
  provider        = "prisma-client"
  output          = "../src/generated/prisma"
  previewFeatures = ["views"]
  moduleFormat    = "cjs"
}

datasource db {
  provider = "postgresql"
}

model Usuario {
  id            Int        @id @default(autoincrement())
  nombre1       String
  nombre2       String?
  apellido1     String
  apellido2     String?
  telefono      String     @db.VarChar(10)
  nombreUsuario String     @unique
  email         String?    @unique
  cedula        String     @unique @db.VarChar(10)
  password      String
  rolId         Int
  estado        String?    @default("A")
  createdAt     DateTime   @default(now())
  updatedAt     DateTime?  @updatedAt
  acciones      Accion[]
  prestamos     Prestamo[]
  rol           Rol        @relation(fields: [rolId], references: [id])
}

model Rol {
  id          Int       @id @default(autoincrement())
  nombre      String    @unique
  descripcion String?
  estado      String?   @default("A")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime? @updatedAt
  usuarios    Usuario[]
}

model Accion {
  id        Int       @id @default(autoincrement())
  usuarioId Int
  periodo   String
  numero    Int
  valor     Int
  acumulado Int?
  fecha     DateTime
  estado    String?   @default("A")
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt
  usuario   Usuario   @relation(fields: [usuarioId], references: [id])
}

model Prestamo {
  id           Int               @id @default(autoincrement())
  usuarioId    Int
  numSolicitud Int?
  periodo      String?
  monto        Float
  interes      Float
  cuotas       Int
  fecha        DateTime
  frecuencia   String            @default("MENSUAL")
  estado       String?           @default("A")
  createdAt    DateTime          @default(now())
  updatedAt    DateTime?         @updatedAt
  detalles     DetallePrestamo[]
  usuario      Usuario           @relation(fields: [usuarioId], references: [id])
}

model DetallePrestamo {
  id          Int       @id @default(autoincrement())
  prestamoId  Int
  fecha       DateTime?
  cuotaNum    Int
  monto       Float
  interes     Float
  capital     Float
  saldo       Float
  fechaPago   DateTime?
  periodoPago String?
  estadoPago  String?   @default("PENDIENTE")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime? @updatedAt
  prestamo    Prestamo  @relation(fields: [prestamoId], references: [id])
}

view VmDistribucionPeriodos {
  periodo               String
  mes                   String
  totalcobrado          Float?
  totalinteres          Float?
  totalcapital          Float?
  interesporciento      Float?
  interesmenosporciento Float?
  totalacciones         BigInt?
  utilidadporaccion     Float?
}
